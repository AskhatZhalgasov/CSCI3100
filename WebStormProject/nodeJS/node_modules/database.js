const MongoClient = require('mongodb').MongoClient;
const database_url = "";
const database_name = "csci3100";
//connect to mongo DB
module.exports.connect_DB = function connect_to_DB()
{
    MongoClient.connect(database_url, { useUnifiedTopology: true }, function (err, db)
    {
        if (err)
        {
            console.log('[CONNECT ERROR] - ', err.message);
            return;
        }
        console.log("Connection is successful!");
        db.close();
    });
};


//  query document in mongoDB
//set connection parameter at first
module.exports.query_doc = function query_doc_in_DB()
{
    MongoClient.connect(database_url, { useUnifiedTopology: true }, function (err, db) {
        if (err) {
            console.log('[CONNECT ERROR] - ', err.message);
            return;
        }
        var dbo = db.db(database_name);
        dbo.collection("student").find({ 'student_id': 1155139458 }).toArray(function (err, result) {
            if (err) {
                console.log('[QUERY ERROR] - ', err.message);
                return;
            }
            console.log(result);
            db.close();
        });
    });
};


//Insert document in MongoDB
//set connection parameter at first
module.exports.add_to_DB = function add_to_database(DB_name, myobj)
{
    MongoClient.connect(database_url, { useUnifiedTopology: true }, function (err, db)
    {
        if (err) {
            console.log('[CONNECT ERROR] - ', err.message);
            return;
        }
        var dbo = db.db(database_name);
        //var myobj = { student_id: 1155139458, name: 'MIKE', gender: 'MALE', grade: 98 };
        dbo.collection(DB_name).insertOne(myobj, function (err, res) {
            if (err) {
                console.log('[INSERT ERROR] - ', err.message);
                return;
            }
            console.log(res);
            db.close();
        });
    });
};


//update document in mongo db
//set connection parameter at first
module.exports.update_doc = function updata_doc_in_DB(DB_name, whereStr, updateStr)
{
    MongoClient.connect(database_url, { useUnifiedTopology: true }, function (err, db) {
        if (err) {
            console.log('[CONNECT ERROR] - ', err.message);
            return;
        }
        var dbo = db.db(database_name);
        //var whereStr = { "student_id": 1155139458 };
        //var updateStr = { $set: { "grade": 85 } };
        dbo.collection(DB_name).update(whereStr, updateStr, function (err, res) {
            if (err) {
                console.log('[UPDATE ERROR] - ', err.message);
                return;
            }
            console.log(res);
            db.close();
        });
    });
};


//delete document in mongo db
//set connection parameter at first
module.exports.delete_doc = function delete_doc_from_DB(DB_name, whereStr)
{
    MongoClient.connect(database_url, { useUnifiedTopology: true }, function (err, db)
    {
        if (err) {
            console.log('[CONNECT ERROR] - ', err.message);
            return;
        }
        var dbo = db.db(database_name);
        //var whereStr = { "student_id": 1155139488 };
        dbo.collection(DB_name).deleteOne(whereStr, function (err, obj)
        {
            if (err) {
                console.log('[DELETE ERROR] - ', err.message);
                return;
            }
            console.log(obj);
            db.close();
        });
    });
};
